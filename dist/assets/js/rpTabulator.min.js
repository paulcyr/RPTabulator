/*! RPTabulator - v0.5.0 - 2016-09-02
 * https://github.com/thisispaulcyr/RPTabulator
 * Paul Cyr <web@thisispaul.ca> (http://thisispaul.ca)
 * License: Microsoft Reference Source License (http://referencesource.microsoft.com/license.html) */
 'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&'function'==typeof Symbol&&obj.constructor===Symbol?'symbol':typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return call&&('object'==typeof call||'function'==typeof call)?call:self}function _inherits(subClass,superClass){if('function'!=typeof superClass&&null!==superClass)throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}define(['jquery','lf/lovefield','anotherUtility','jquery.validate','datatables.net','datatables.net-responsive'],function(a,b,c){var d=function(){function f(){var _this=this;_classCallCheck(this,f);// Load existing configuration
try{this.config=JSON.parse(localStorage.getItem('config')),('object'!=_typeof(this.config)||0===this.config.length)&&(this.config={})}catch(h){this.config={}}this.config.lang=(window.navigator.userLanguage||window.navigator.language).substr(0,2);var g={name:{en:'Ranked Pairs Tabulator'},'Error:':{fr:'Erreur:'},'Loading...':{fr:'En cours de chargement...'},'Are you sure you want to close the program?':{},Elections:{},Candidates:{},Voting:{},Results:{},'No elections have been created.':{},'Create Election':{},'ID:':{},'Created:':{},'Modified:':{},Default:{},'Ballot:':{},'No candidates have been added.':{},'Add an individual candidate':{},'Import candidates':{},'Candidate\'s Name':{},'Candidates\' Names':{},'One candidate per line':{},Add:{},Import:{},Cancel:{},'A candidate with the name "':{},'" already exists. Remove that name or enter a different one.':{},'The following candidate names already exist:':{},'Remove those names or enter different ones.':{},'No "pageLoaded" event was triggered within five seconds of the start of page load. This may be due to slow loading or a missing "pageLoaded" trigger.':{}};// Populate the strings object with the current langauge
for(var h in this.config.strings=this.config.strings||{},g)'undefined'==typeof this.config.strings[h]&&(g[h][this.lang]?this.config.strings[h]=g[h][this.lang]:this.config.strings[h]=h);// Open DB and create tables
if(localStorage.setItem('config',JSON.stringify(this.config)),this.strings=this.config.strings,this.loadedItems={},'function'==typeof window.jQuery?(this.loadedItems.jQuery=!0,window.$!==window.jQuery&&(window.$=window.jQuery)):this.loadedItems.jQuery=!1,window.lf){var _h=this.lf=window.lf;this.ds=_h.schema.create('RPTabulator',1),this.ds.createTable('elections').addColumn('id',_h.Type.INTEGER).addColumn('created',_h.Type.DATE_TIME).addColumn('modified',_h.Type.DATE_TIME).addColumn('name',_h.Type.STRING).addColumn('ballot',_h.Type.OBJECT).addColumn('results',_h.Type.OBJECT).addPrimaryKey(['id'],!0).addIndex('idx__modified',['modified'],!1,_h.Order.DESC).addIndex('idx__name',['name'],!0,_h.Order.ASC),this.ds.createTable('candidates').addColumn('id',_h.Type.INTEGER).addColumn('created',_h.Type.DATE_TIME).addColumn('modified',_h.Type.DATE_TIME).addColumn('election_id',_h.Type.INTEGER).addColumn('name',_h.Type.STRING).addPrimaryKey(['id'],!0).addUnique('unique__election_id__name',['election_id','name']).addIndex('idx__election_id',['election_id'],!1,_h.Order.DESC).addIndex('idx__election_id__name',['election_id','name'],!0,_h.Order.DESC).addForeignKey('fk__election_id__elections_id',{local:'election_id',ref:'elections.id',action:_h.ConstraintAction.CASCADE}),this.ds.createTable('ballots').addColumn('id',_h.Type.INTEGER).addColumn('created',_h.Type.DATE_TIME).addColumn('modified',_h.Type.DATE_TIME).addColumn('election_id',_h.Type.INTEGER).addColumn('vote',_h.Type.OBJECT).addPrimaryKey(['id'],!0).addIndex('idx__election_id',['election_id'],!1,_h.Order.DESC).addForeignKey('fk__election_id__elections_id',{local:'election_id',ref:'elections.id',action:_h.ConstraintAction.CASCADE}),this.ds.connect().then(function(j){_this.db=j,_this.loadedItems.lf=!0,a(document).trigger('dbConnected.rpTabulator')})}}return _createClass(f,[{key:'relativePagePath',value:function relativePagePath(g){// If a URL, get the pathname
if(/^https?:\/\/.*/i.test(g)){var h=document.createElement('a');h.href=g,g=h.pathname}return g.replace(new RegExp('^'+window.url.REL_PATH,'i'),'')||'elections';// Elections is default
}},{key:'load',value:function load(){var _this2=this;if(!0==this.loadedItems.loadMethod)throw new Error('RPTabulator already loaded.');// Load any error messages;
if(this.$pageTitle=a('.page-title'),this.$pageSubtitle=a('.page-subtitle'),this.$content=a('#main > .container > .content'),!0!==this.loadedItems.jQuery){var _g=new c.ErrorMessage('A required component appears to be missing and could not be loaded.',{type:'danger',code:'Missing component: jQuery'});_g.style.textAlign='center',container.appendChild(_g)}if(!0!==this.loadedItems.lf)if(window.lf){// Lovefield exists, but failed to load.
var _g2=new c.ErrorMessage('Your browser may be unable to support a required commponent.',{type:'danger',details:'<p>Only the following browsers are compatible:</p><ul style="display: inline-block; text-align: left; text-align: start;"><li>Google Chrome (37+)</li><li>Mozilla Firefox (31+)</li><li>Microsoft Edge</li><li>Microsoft Internet Explorer (10+)</li><li>Apple Safari (5.1+)</li></ul>',detailsContainerType:'div',code:'Failed component: Lovefield (database)'});a(_g2).css('text-align','center'),container.appendChild(_g2)}else{// Lovefield could not be found.
var _g3=new c.ErrorMessage('A required component could not be loaded.',{type:'danger',code:'Missing component: Lovefield (database)'});a(_g3).css('text-align','center'),container.appendChild(_g3)}// Throw the error for any failed dependencies
if(!0!==this.loadedItems.jQuery)throw new Error('The required dependency \'jQuery\' could not be loaded.');if(!0!==this.loadedItems.lf)if(window.lf)throw new Error('The required dependency \'Lovefield\' was found but could not be loaded.');else throw new Error('The required dependency \'Lovefield\' could not be loaded.');a('nav.primary .toggle').css('display',''),this.menus={default:[{href:window.url.ROOT,label:this.strings.Elections},{href:window.url.ROOT+encodeURI(this.strings.Candidates.toLowerCase()),label:this.strings.Candidates},{href:window.url.ROOT+encodeURI(this.strings.Voting.toLowerCase()),label:this.strings.Voting},{href:window.url.ROOT+encodeURI(this.strings.Results.toLowerCase()),label:this.strings.Results}]},a(window).on('popstate',function(){_this2.loadPage(window.location.href,!1)}),a(document).on('pageLoaded.rpTabulator',function(){a('a').filter(function(){return this.href// ...and it has a URL...
&&!this.href.match(/^.+\.\S{3,4}$/i)// ...but the URL does not include a file extention
// ...and it does not have a "target" attribute or it does and that attribue is "_self", effectively excluding targets such as "_blank"
&&(!a(this).attr('target')||'_self'==a(this).attr('target'))}).off('click.navigation.rpTabulator').on('click.navigation.rpTabulator',function(g){g.preventDefault();var h=g.currentTarget.href;c.isSameTarget(h,_this2.prevURL)||_this2.loadPage(h)})}),this.loadPage(window.location.href,!1),this.loadedItems.loadMethod=!0}},{key:'loadPage',value:function loadPage(g,h){var _this3=this;if(!c.validator.isString(g))throw new c.ArgumentError(g,'url','loadPage',Object.getPrototypeOf(this).constructor.name);if(!('undefined'==typeof h||c.validator.isBoolean(h)))throw new c.ArgumentError(h,'isJSJax','loadPage',Object.getPrototypeOf(this).constructor.name);0<g.length||(g=window.url.ROOT),h=!1!==h;var j=void 0;if(/^https?:\/\/.*/i.test(g)?j=this.relativePagePath(g):(j=g,g=window.url.ROOT+j),a(document).trigger('pageLoading.rpTabulator'),this.page=new f.Page(this,j),h){var l=this.page.getTitle();history.pushState(null,l,g)}var k=setTimeout(function(){console.warn(_this3.strings['No "pageLoaded" event was triggered within five seconds of the start of page load. This may be due to slow loading or a missing "pageLoaded" trigger.'])},5000);a(document).one('pageLoaded.rpTabulator',function(){clearTimeout(k)}),this.page.load(),this.prevURL=function(){return{protocol:window.location.protocol,hostname:window.location.hostname,pathname:window.location.pathname}}()}},{key:'insert',value:function insert(g,h){var _this4=this;if(!c.validator.isNotEmptyString(g))throw new c.ArgumentError(g,'tableName','insert',Object.getPrototypeOf(this).constructor.name);if(!(c.validator.isNotEmptyArray(h)&&h.every(function(l){return c.validator.isNotEmptyObject(l)})||c.validator.isNotEmptyObject(h)))throw new c.ArgumentError(options,'payload','insert',Object.getPrototypeOf(this).constructor.name);var j=rp.db.getSchema().table(g),k=[];return c.validator.isNotEmptyArray(h)?h.forEach(function(l){'id'in l&&delete l.id,l.created=l.modified=Object.freeze(new Date),k.push(j.createRow(l))}):('id'in h&&delete h.id,h.created=h.modified=Object.freeze(new Date),k.push(j.createRow(h))),new Promise(function(l,m){_this4.db.insertOrReplace().into(j).values(k).exec().then(function(n){l(n)})})}},{key:'delete',value:function _delete(g,h){var _this5=this;if(!c.validator.isNotEmptyString(g))throw new c.ArgumentError(g,'tableName','delete',Object.getPrototypeOf(this).constructor.name);if(!(c.validator.isNotEmptyArray(h)&&h.every(function(l){return c.validator.isNumeric(h)})||c.validator.isNumeric(h)))throw new c.ArgumentError(h,'ids','delete',Object.getPrototypeOf(this).constructor.name);var j=rp.db.getSchema().table(g),k=c.validator.isNotEmptyArray(h)?j.id.in(h):j.id.eq(h);return new Promise(function(l,m){_this5.db.delete().from(j).where(k).exec().then(function(n){l(n)})})}},{key:'isUnique',value:function isUnique(g,h,j){var _this6=this;if(!c.validator.isNotEmptyString(g))throw new c.ArgumentError(g,'tableName','isUnique',Object.getPrototypeOf(this).constructor.name);var k=this.lf,l=this.db.getSchema().table(g),m=void 0,n=void 0;if(c.validator.isNotEmptyArray(h))(function(){// Array of conditions
var o=[];m=h[0],h.forEach(function(p){if(!c.validator.isNotEmptyArray(p)||2!==p.length)throw new c.ArgumentError(h,'conditions (argument 2)','isUnique',Object.getPrototypeOf(_this6).constructor.name);o.push(l[p[0]].eq(p[1]))}),n=k.op.and.apply(k,o)})();else{if(!c.validator.isNotEmptyString(h))throw new c.ArgumentError(h,'columnName (argument 2)','isUnique',Object.getPrototypeOf(this).constructor.name);if(!c.validator.isNotEmptyString(j))throw new c.ArgumentError(j,'value','isUnique',Object.getPrototypeOf(this).constructor.name);l=this.db.getSchema().table(g),m=h,n=l[m].eq(j)}return new Promise(function(o,p){_this6.db.select(k.fn.count(l[m])).from(l).where(n).exec().then(function(q){'COUNT('+m+')'in q[0]?o(0===q[0]['COUNT('+m+')']):o(0===q[0]['COUNT(*)'])})})}},{key:'areUnique',value:function areUnique(g,h){var _this7=this;function j(m){// Three-level nested array with the inner-most array of length two.
// [
//   [
//      [fielda1, valuea1], ..., [fieldan, valuean] // Conditions for a query
//   ],
//   ...,
//   [
//      [fieldz1, valuez1], ..., [fieldzn, valuezn] // Additional query
// ]]
return c.validator.isNotEmptyArray(m)&&m.every(function(n){return c.validator.isNotEmptyArray(n)&&n.every(function(o){return 2===o.length})})}if(h){if(!c.validator.isNotEmptyString(g))throw new c.ArgumentError(g,'tableName (argument 1)','areUnique',Object.getPrototypeOf(this).constructor.name);if(!j(h))throw new c.ArgumentError(h,'queriesArrays (argument 2)','areUnique',Object.getPrototypeOf(this).constructor.name)}else if(!(// Array of objects with properties 'table' and 'queries'. 'table' must be string. 'queries' must be valid queries per validQueries()
c.validator.isNotEmptyArray(g)&&g.every(function(m){return c.validator.isNotEmptyObject(m)&&'table'in m&&c.validator.isNotEmptyString(m.table)&&'queries'in m&&j(m.queries)})))throw new c.ArgumentError(g,'argument 1','areUnique',Object.getPrototypeOf(this).constructor.name);var k=[],l=[];// Normalize
return h?h.forEach(function(m){k.push({table:g,queries:m})}):k=g,k.forEach(function(m){l.push(_this7.isUnique.call(_this7,m.table,m.queries))}),Promise.all(l).then(function(m){for(var n=[],o=0;o<m.length;o++)n.push({table:k[o].table,conditions:k[o].queries,isUnique:m[o]});return{areUnique:m.every(function(o){return o}),details:n}})}}]),f}();return d.Page=function(){function _class(g,h){var _this8=this;if(_classCallCheck(this,_class),!(g instanceof d))throw new c.ArgumentError(g,'rp','constructor',Object.getPrototypeOf(this).constructor.name);if(!c.validator.isNotEmptyString(h))throw new c.ArgumentError(h,'id','constructor',Object.getPrototypeOf(this).constructor.name);this.rp=g,this.id=h,this.params=[];var j=function j(k,l,m){if(1<k.length&&!(k[0]in l))throw new c.ArgumentError(k,'pageArray','getPageFromArray',Object.getPrototypeOf(_this8).constructor.name);return m=m||[],1<k.length&&'subpages'in l[k[0]]&&k[1]in l[k[0]].subpages&&'object'==_typeof(l[k[0]].subpages[k[1]])?j(k.slice(1),l[k[0]].subpages,m.push(k[0])):(1<k.length&&(_this8.params=k.slice(1)),l[k[0]].parent=m,l[k[0]])};this.page=j(h.split('/'),d.pages),this.name=c.validator.isNotEmptyString(this.page.name)?this.page.name:h}return _createClass(_class,[{key:'setPrimaryMenu',value:function setPrimaryMenu(g){var h=new c.Menu(g);a('nav.primary > .container > .menu').remove(),a('nav.primary > .container').append(h.get())}},{key:'load',value:function load(){if(a(window).trigger('onNavigate'),a(window).off('.rpTabulator'),this.setPrimaryMenu(c.validator.isNotEmptyObject(this.page.menu)?this.page.menu:this.rp.menus.default),this.setTitle(),this.setHeader(),'function'==typeof this.page.generator)this.page.generator.call(this,this.params);else throw new Error('Unable to load page: '+this.id)}},{key:'getTitle',value:function getTitle(){var g='string'==typeof this.customTitle?this.customTitle:this.name;return this.titleOverride?g:this.rp.strings.name+' | '+g}},{key:'setTitle',value:function setTitle(){var g=0>=arguments.length||void 0===arguments[0]?null:arguments[0],h=1>=arguments.length||void 0===arguments[1]?!1:arguments[1];this.customTitle=g||null,this.titleOverride=h||!1;var j=void 0,k=' > ',l=this.getTitle();j=this.page.parent&&this.page.parent instanceof Array?this.page.parent.join(k):'',a('title','head').text(l),j?rp.$pageTitle.html(g+k+j):rp.$pageTitle.html(l)}},{key:'setHeader',value:function setHeader(){var g=0>=arguments.length||void 0===arguments[0]?null:arguments[0];!1===g&&(this.header=null)}}]),_class}(),d.Candidates=function(_c$Records){function _class2(g){_classCallCheck(this,_class2);var _this9=_possibleConstructorReturn(this,(_class2.__proto__||Object.getPrototypeOf(_class2)).call(this,'candidates',c.UUIDv4()));return _this9.candidates=g||[],_this9.candidates=g||[],_this9}return _inherits(_class2,_c$Records),_class2}(c.Records),d.pages=d.pages||{},d.pages.elections={name:'Elections',generator:function generator(){var f=rp.db.getSchema().table('elections');rp.db.select().from(f).exec().then(function(g){g.forEach(function(k){k.created=k.created.toLocaleString(),k.modified=k.modified.toLocaleString()});var h=void 0,j=document.createElement('a');a(j).attr('href',window.url.ROOT+'elections/create').html(rp.strings['Create Election']).addClass('btn btn-primary'),0===g.length?(h=rp.strings['No elections have been created.'],rp.$content.html(h,j)):(g.forEach(function(k,l){g[l]={href:window.url.ROOT+'election/'+k.id,values:k}}),h=c.tableGenerator(['Name','Created','Modified','Ballot','Results'],g,{tableClass:'table table-striped'}),rp.$content.html(j).append(h),a('.table').DataTable({paging:!1,searching:!1,info:!1})),a(document).trigger('pageLoaded.rpTabulator')})},subpages:{}},d.pages.elections.subpages.create={name:'Create Election',generator:function generator(){var f=void 0,g=new c.Form([{type:'fieldset',inputs:[{type:'input',name:'name',label:'Name',required:!0,class:'form-control'},{type:'submit',value:'Save & Continue',class:'btn btn-primary save-continue'},{type:'submit',value:'Save & Return',class:'btn btn-default save-return'}]}],{method:'post',wrapInputs:{element:'div',class:'form-group'},labels:{class:'control-label'}});rp.$content.html(g.form),g.setSubmitHandler(function(){}),f='#'+g.id,a('input[type="submit"]',f).on('click.rpTabulator',function(h){var j=a('[name="name"]','#'+g.id).first().val();rp.isUnique('elections','name',a('input[name="name"]').val()).then(function(k){a('#'+g.id).trigger('formComplete.'+g.id),k?rp.insert('elections',{name:j}).then(function(l){a(h.currentTarget).hasClass('save-return')?rp.loadPage('elections'):rp.loadPage('election/'+l[0].id)}):g.showError('name',{inputClass:'has-error',messageClass:'alert alert-danger',message:'An election with that name already exists. Enter a different name.'})})}),a(document).trigger('pageLoaded.rpTabulator')}},d.pages.election={name:'Election',generator:function generator(f){var _this11=this;c.pageCSS('election');var g=rp.db.getSchema().table('elections'),h=rp.db.getSchema().table('candidates');rp.db.select().from(g).leftOuterJoin(h,g.id.eq(h.election_id)).where(g.id.eq(f[0])).exec().then(function(j){function k(){var G=[];j.forEach(function(H){G.push({candidates:H.candidates.name,delete:p(H.candidates.id)})}),u=c.tableGenerator(['Candidates','Delete'],G,{tableClass:'table table-striped candidates'}),a(E).html(u),v=a('table',E).DataTable({paging:!1,searching:!1,info:!1,responsive:!0,autoWidth:!1,columns:[null,{orderable:!1}]}),a('button.candidate-delete',u).one('click',q)}function l(G,H){0===a('table.candidates').length&&k(),v.row.add([H,p(G)]),a(u).one('click','button.candidate-delete[data-id="'+G+'"]',q)}function m(){a('button.import-candidates').off('click');var G=new c.Form([{type:'fieldset',inputs:[{type:'input',name:'name',label:rp.strings['Candidate\'s Name'],required:!0,class:'form-control'}]},{type:'fieldset',class:'buttons',inputs:[,{type:'submit',value:rp.strings.Add,class:'btn btn-primary add-candidate'},{type:'button',value:rp.strings.Cancel,class:'btn btn-default cancel-add-candidate',formnovalidate:!0}]}],{wrapInputs:{element:'div',class:'form-group'},labels:{class:'control-label'}});G.setSubmitHandler(function(){}),w='#'+G.id,a(G.form).hide().insertAfter('.candidate-controls').slideDown(100),a('input[type="submit"], button',w).on('click.rpTabulator',{formObj:G},o)}function n(){a('button.add-candidate').off('click');var G=new c.Form([{type:'fieldset',inputs:[{type:'textarea',name:'names',label:rp.strings['Candidates\' Names']+' &ndash; '+rp.strings['One candidate per line'],required:!0,class:'form-control'}]},{type:'fieldset',class:'buttons',inputs:[,{type:'submit',value:rp.strings.Import,class:'btn btn-primary import-candidates'},{type:'button',value:rp.strings.Cancel,class:'btn btn-default cancel-import-candidates',formnovalidate:!0}]}],{wrapInputs:{element:'div',class:'form-group'},labels:{class:'control-label'}});G.setSubmitHandler(function(){}),w='#'+G.id,a(G.form).hide().insertAfter('.candidate-controls').slideDown(100),a('input[type="submit"], button',w).on('click.rpTabulator',{formObj:G},o)}function o(G){function H(J,K){if(!c.validator.isNumeric(J))throw new c.ArgumentError(J,'election_id','insertCandidates',Object.getPrototypeOf(this).constructor.name);if(!c.validator.isNotEmptyArray(K))throw new c.ArgumentError(K,'names','insertCandidates',Object.getPrototypeOf(this).constructor.name);var L=[],M=void 0;return K.forEach(function(N){L.push({election_id:J,name:N})}),rp.insert('candidates',L).then(function(N){// Update modified timestamp in elections table
return M=N,rp.db.update(g).set(g.modified,Object.freeze(new Date)).where(g.id.eq(J)).exec()}).then(function(){M.forEach(function(N){l(N.id,N.name)}),v.draw(),I()})}function I(){a(w).fadeOut(50,function(){a(this).remove()}),a('button.add-candidate').one('click',m),a('button.import-candidates').one('click',n)}G.preventDefault(),a(G.currentTarget).hasClass('add-candidate')?function(){var J=a('[name="name"]',w).first().val(),K=[['name',J],['election_id',r.id]];rp.isUnique('candidates',K).then(function(L){a(w).trigger('formComplete.rpTabulator'),L?H(r.id,[J]):G.data.formObj.showError('name',{inputClass:'has-error',messageClass:'alert alert-danger',message:'An candidate with that name already exists. Enter a different name.'})})}():a(G.currentTarget).hasClass('import-candidates')?function(){var J=a('[name="names"]',w).first().val().split(/\r|\n/),K=[];J.forEach(function(L){K.push([['name',L],['election_id',r.id]])}),rp.areUnique('candidates',K).then(function(L){a(w).trigger('formComplete.rpTabulator'),L.areUnique?H(r.id,J):function(){var M=[];L.details.forEach(function(O){!0===O.isUnique||O.conditions.some(function(P){if('name'===P[0])return M.push(P[1]),!0})}),M.sort();var N=1===M.length?rp.strings['A candidate with the name "']+M.toString()+rp.strings['" already exists. Remove that name or enter a different one.']:rp.strings['The following candidate names already exist:']+' '+M.join('; ')+'. '+rp.strings['Remove those names or enter different ones.'];G.data.formObj.showError('names',{inputClass:'has-error',messageClass:'alert alert-danger',message:N})}()})}():I()}function p(G){var H=document.createElement('button');return H.innerHTML='&times;',H.setAttribute('data-id',G),a(H).addClass('btn btn-default btn-sm candidate-delete'),H.outerHTML}function q(G){var _this10=this,H=G.currentTarget.dataset.id;return rp.delete('candidates',H).then(function(I){// Update modified timestamp in elections table
return rp.db.update(g).set(g.modified,Object.freeze(new Date)).where(g.id.eq(r.id)).exec()}).then(function(){v.row(a(_this10).parents('tr')).remove().draw()})}var r=j[0].elections,s=j[0].candidates,t=a('.page-title').html(),u=void 0,v=void 0,w=void 0;rp.$content.html(''),t+=': '+r.name,_this11.setTitle(t,!0),rp.$pageSubtitle.text(rp.strings['ID:']+' '+r.id);// Left column
var x=document.createElement('div');x.classList.add('col-left');var y=r.created.toLocaleString(),z=r.modified.toLocaleString(),A='undefined'==typeof r.ballotType?rp.strings.Default:r.ballotType,B=[[rp.strings['Created:'],y],[rp.strings['Modified:'],z],[rp.strings['Ballot:'],A]];x.appendChild(c.tableGenerator(B,{tableClass:'general'}));var C=document.createElement('div'),D=[['<button class="btn btn-default add-candidate">'+rp.strings['Add an individual candidate']+'</button>','<button class="btn btn-default import-candidates">'+rp.strings['Import candidates']+'</button>']];C.classList.add('candidate-controls'),C.appendChild(c.tableGenerator(D)),x.appendChild(C);// Right column
var E=document.createElement('div');a(E).addClass('col-right candidates'),null===s.id?E.innerHTML='<p>'+rp.strings['No candidates have been added.']+'</p>':k();var F=document.createElement('div');F.classList.add('container'),a(F).append(x,E),rp.$content.append(F),a('button.add-candidate').one('click',m),a('button.import-candidates').one('click',n),a(document).trigger('pageLoaded.rpTabulator')})}},d});